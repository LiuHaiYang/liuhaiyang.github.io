<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="meet you">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->





<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>数据库连接池 | meet you</title>


    <link rel="alternate" href="/atom.xml" title="meet you" type="application/atom+xml">


    <link rel="icon" href="/img/favicon.ico">

    


    <link rel="stylesheet" href="//imsun.github.io/gitment/style/default.css">


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    


    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://snippet.shenliyang.com/img/banner.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Ocean'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> Always believe youself. </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">meet you</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/python/"><i class="fa "></i>python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/java/"><i class="fa "></i>JAVA</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/生活/"><i class="fa "></i>生活</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="数据库连接池">
            
	            数据库连接池
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
                    <a href="/tags/java" title='java'>
                        java
                    </a>
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2022/06/27</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <p><img src="https://images.pexels.com/photos/10757791/pexels-photo-10757791.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1600&amp;lazy=load" alt="image"></p>
<p>官方：数据库连接池（Connection pooling）是程序启动时建立足够的数据库连接，并将这些连接组成一个连接池，由程序动态地对池中的连接进行申请，使用，释放。</p>
<p>个人理解：创建数据库连接是一个很耗时的操作，也容易对数据库造成安全隐患。所以，在程序初始化的时候，集中创建多个数据库连接，并把他们集中管理，供程序使用，可以保证较快的数据库读写速度，还更加安全可靠。</p>
<h3 id="不使用连接池流程"><a href="#不使用连接池流程" class="headerlink" title="不使用连接池流程"></a>不使用连接池流程</h3><p><img src="https://upload-images.jianshu.io/upload_images/22757822-26bccc03619cfa90.png?imageMogr2/auto-orient/strip|imageView2/2/w/472/format/webp" alt="image"></p>
<p>不使用数据库连接池的步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TCP建立连接的三次握手</span><br><span class="line">MySQL认证的三次握手</span><br><span class="line">真正的SQL执行</span><br><span class="line">MySQL的关闭</span><br><span class="line">TCP的四次握手关闭</span><br><span class="line">可以看到，为了执行一条SQL，却多了非常多我们不关心的网络交互。</span><br></pre></td></tr></table></figure>
<p>优点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实现简单</span><br></pre></td></tr></table></figure></p>
<p>缺点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">网络IO较多</span><br><span class="line">数据库的负载较高</span><br><span class="line">响应时间较长及QPS较低</span><br><span class="line">应用频繁的创建连接和关闭连接，导致临时对象较多，GC频繁</span><br><span class="line">在关闭连接后，会出现大量TIME_WAIT 的TCP状态（在2个MSL之后关闭）</span><br></pre></td></tr></table></figure></p>
<h3 id="传统的连接机制与数据库连接池的运行机制区别"><a href="#传统的连接机制与数据库连接池的运行机制区别" class="headerlink" title="传统的连接机制与数据库连接池的运行机制区别"></a>传统的连接机制与数据库连接池的运行机制区别</h3><p>传统统链接:</p>
<p>Java应用程序访问数据库的过程是：</p>
<ul>
<li>装载数据库驱动程序；</li>
<li>通过JDBC建立数据库连接；</li>
<li>访问数据库，执行SQL语句；</li>
<li>断开数据库连接。</li>
</ul>
<p>使用了数据库连接池的机制：<br>（1）  程序初始化时创建连接池<br>（2） 使用时向连接池申请可用连接<br>（3） 使用完毕，将连接返还给连接池<br>（4） 程序退出时，断开所有连接，并释放资源</p>
<h3 id="为何要使用数据库连接池"><a href="#为何要使用数据库连接池" class="headerlink" title="为何要使用数据库连接池"></a>为何要使用数据库连接池</h3><p>数据库连接池负责分配,管理和释放数据库连接,它允许应用程序重复使用一个现有的数据库连接,而不是重新建立一个。</p>
<p>数据库连接池在初始化时将创建一定数量的数据库连接放到连接池中, 这些数据库连接的数量是由最小数据库连接数来设定的.无论这些数据库连接是否被使用,连接池都将一直保证至少拥有这么多的连接数量.连接池的最大数据库连接数量限定了这个连接池能占有的最大连接数,当应用程序向连接池请求的连接数超过最大连接数量时,这些请求将被加入到等待队列中.</p>
<p>数据库连接池的最小连接数和最大连接数的设置要考虑到以下几个因素:</p>
<ul>
<li>最小连接数:是连接池一直保持的数据库连接,所以如果应用程序对数据库连接的使用量不大,将会有大量的数据库连接资源被浪费.</li>
<li>最大连接数:是连接池能申请的最大连接数,如果数据库连接请求超过次数,后面的数据库连接请求将被加入到等待队列中,这会影响以后的数据库操作</li>
<li>如果最小连接数与最大连接数相差很大:那么最先连接请求将会获利,之后超过最小连接数量的连接请求等价于建立一个新的数据库连接.不过,这些大于最小连接数的数据库连接在使用完不会马上被释放,他将被放到连接池中等待重复使用或是空间超时后被释放.</li>
</ul>
<h3 id="连接池主要参数"><a href="#连接池主要参数" class="headerlink" title="连接池主要参数"></a>连接池主要参数</h3><p>使用连接池时，要配置一下参数</p>
<ul>
<li>最小连接数：是连接池一直保持的数据库连接,所以如果应用程序对数据库连接的使用量不大,将会有大量的数据库连接资源被浪费.</li>
<li>最大连接数：是连接池能申请的最大连接数,如果数据库连接请求超过次数,后面的数据库连接请求将被加入到等待队列中,这会影响以后的数据库操作</li>
<li>最大空闲时间</li>
<li>获取连接超时时间</li>
<li>超时重试连接次数</li>
</ul>
<h3 id="使用数据库连接池的关键点"><a href="#使用数据库连接池的关键点" class="headerlink" title="使用数据库连接池的关键点"></a>使用数据库连接池的关键点</h3><ul>
<li>并发问题 锁</li>
<li>事务处理  DB连接池必须要确保某一时间内一个 conn 只能分配给一个线程。不同 conn 的事务是相互独立的。</li>
<li>连接池的分配与释</li>
<li>连接池的配置与维护  如何确保连接池中的最小连接数呢？有动态和静态两种策略。动态即每隔一定时间就对连接池进行检测，如果发现连接数量小于最小连接数，则补充相应数量的新连接,以保证连接池的正常运转。静态是发现空闲连接不够时再去检查。</li>
</ul>
<h3 id="使用数据库连接池的优势和其工作原理"><a href="#使用数据库连接池的优势和其工作原理" class="headerlink" title="使用数据库连接池的优势和其工作原理"></a>使用数据库连接池的优势和其工作原理</h3><ul>
<li>连接池的优势<ul>
<li>减少连接创建时间。</li>
<li>简化的编程模式。</li>
<li>控制资源的使用。</li>
</ul>
</li>
<li>连接池的工作原理</li>
</ul>
<p>连接池技术的核心思想是连接复用，通过建立一个数据库连接池以及一套连接使用、分配和管理策略，使得该连接池中的连接可以得到高效、安全的复用，避免了数据库连接频繁建立、关闭的开销。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">连接池的工作原理主要由三部分组成，分别为连接池的建立、连接池中连接的使用管理、连接池的关闭。</span><br><span class="line"></span><br><span class="line">第一、连接池的建立。一般在系统初始化时，连接池会根据系统配置建立，并在池中创建了几个连接对象，以便使用时能从连接池中获取。连接池中的连接不能随意创建和关闭，这样避免了连接随意建立和关闭造成的系统开销。Java中提供了很多容器类可以方便的构建连接池，例如Vector、Stack等。</span><br><span class="line"></span><br><span class="line">第二、连接池的管理。连接池管理策略是连接池机制的核心，连接池内连接的分配和释放对系统的性能有很大的影响。其管理策略是：</span><br><span class="line"></span><br><span class="line">当客户请求数据库连接时，首先查看连接池中是否有空闲连接，如果存在空闲连接，则将连接分配给客户使用；如果没有空闲连接，则查看当前所开的连接数是否已经达到最大连接数，如果没达到就重新创建一个连接给请求的客户；如果达到就按设定的最大等待时间进行等待，如果超出最大等待时间，则抛出异常给客户。</span><br><span class="line">当客户释放数据库连接时，先判断该连接的引用次数是否超过了规定值，如果超过就从连接池中删除该连接，否则保留为其他客户服务。</span><br><span class="line"></span><br><span class="line">该策略保证了数据库连接的有效复用，避免频繁的建立、释放连接所带来的系统资源开销。</span><br><span class="line"></span><br><span class="line">第三、连接池的关闭。当应用程序退出时，关闭连接池中所有的连接，释放连接池相关的资源，该过程正好与创建相反。</span><br></pre></td></tr></table></figure></p>
<h3 id="常用连接池"><a href="#常用连接池" class="headerlink" title="常用连接池"></a>常用连接池</h3><h4 id="dbcp"><a href="#dbcp" class="headerlink" title="dbcp"></a>dbcp</h4><h4 id="c3p0"><a href="#c3p0" class="headerlink" title="c3p0"></a>c3p0</h4><h4 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h4><h4 id="hikari数据库连接池"><a href="#hikari数据库连接池" class="headerlink" title="hikari数据库连接池"></a>hikari数据库连接池</h4><p>HikariCP现在已经是spring-boot-starter-jdbc中自带的默认连接池</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    #url: jdbc:mysql://110.40.181.73:3306/sell?useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;rewriteBatchedStatements=true</span><br><span class="line">    #username: root</span><br><span class="line">    #password: 10086</span><br><span class="line">    #driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    #type: com.zaxxer.hikari.HikariDataSource</span><br><span class="line">      ##  Hikari 连接池配置 ------ 详细配置请访问：https://github.com/brettwooldridge/HikariCP</span><br><span class="line">      ## 最小空闲连接数量</span><br><span class="line">      #hikari:</span><br><span class="line">      # 空闲连接的最大数量</span><br><span class="line">      #minimum-idle: 5</span><br><span class="line">      # 空闲连接存活最大时间，默认600000（10分钟）</span><br><span class="line">      #idle-timeout: 180000</span><br><span class="line">      # 连接池的最大连接数量,超过最大空闲连接的数量之后,经过上面的idle-timeout后连接数量会恢复到minimum-idle</span><br><span class="line">      #maximum-pool-size: 10</span><br><span class="line">      #connection 事务自动提交,默认就是true</span><br><span class="line">      #auto-commit: true</span><br><span class="line">      # 连接池名称</span><br><span class="line">      #pool-name: myHikaricp</span><br><span class="line">      # 此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认1800000即30分钟,为了防止连接雪崩,通常设置的比数据库的闲置时间小几秒</span><br><span class="line">      #max-lifetime: 1800000</span><br><span class="line">      # 连接mysql最大超时时间</span><br><span class="line">      #connection-timeout: 30000</span><br><span class="line">      #connection-test-query: select 1</span><br><span class="line">      # 在test 连接是否可用的时候的最大时间,默认500ms,最少 250ms</span><br><span class="line">      #validation-timeout: 500</span><br><span class="line">    url: jdbc:mysql://110.40.181.73:3306/sell?useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;rewriteBatchedStatements=true</span><br><span class="line">    username: root</span><br><span class="line">    password: 10086</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    type: com.zaxxer.hikari.HikariDataSource</span><br><span class="line">    hikari:</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      idle-timeout: 180000</span><br><span class="line">      maximum-pool-size: 10</span><br><span class="line">      auto-commit: true</span><br><span class="line">      pool-name: myHikaricp</span><br><span class="line">      max-lifetime: 180000</span><br><span class="line">      connection-timeout: 30000</span><br><span class="line">      connection-test-query: select 1</span><br><span class="line">      validation-timeout: 500</span><br></pre></td></tr></table></figure>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 ,图片资源转自pexels © <a href="" target="_blank">Ocean</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2022/07/08/数据库中断/" class="pre-post btn btn-default" title='数据库中断'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">数据库中断</span>
        </a>
    
    
        <a href="/2022/06/24/mysql监控及配置/" class="next-post btn btn-default" title='mysql监控及配置'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">mysql监控及配置</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	<link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css">
<script src="https://jjeejj.github.io/js/gitment.js"></script>

<script>
    var gitment = new Gitment({
        id: 'Mon Jun 27 2022 10:36:52 GMT+0800',
        owner:"LiuHaiYang",
        repo:"liuhaiyang.github.io",
        oauth: {
          client_id:"aacf4f5555aee5bf0770",
          client_secret:"07f91d5b66c30419c14d14349ccadaa91300bc9c"
        },
        perPage:"10",
    });
    gitment.render('comments');
</script>

    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#不使用连接池流程"><span class="toc-text">不使用连接池流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#传统的连接机制与数据库连接池的运行机制区别"><span class="toc-text">传统的连接机制与数据库连接池的运行机制区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为何要使用数据库连接池"><span class="toc-text">为何要使用数据库连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接池主要参数"><span class="toc-text">连接池主要参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用数据库连接池的关键点"><span class="toc-text">使用数据库连接池的关键点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用数据库连接池的优势和其工作原理"><span class="toc-text">使用数据库连接池的优势和其工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用连接池"><span class="toc-text">常用连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dbcp"><span class="toc-text">dbcp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c3p0"><span class="toc-text">c3p0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Druid"><span class="toc-text">Druid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hikari数据库连接池"><span class="toc-text">hikari数据库连接池</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2019
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Ocean</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>