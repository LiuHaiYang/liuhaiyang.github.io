<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="meet you">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->





<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>redis适用规范 | meet you</title>


    <link rel="alternate" href="/atom.xml" title="meet you" type="application/atom+xml">


    <link rel="icon" href="/img/favicon.ico">

    


    <link rel="stylesheet" href="//imsun.github.io/gitment/style/default.css">


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    


    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://snippet.shenliyang.com/img/banner.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Ocean'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> Always believe youself. </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">meet you</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/python/"><i class="fa "></i>python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/java/"><i class="fa "></i>JAVA</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/生活/"><i class="fa "></i>生活</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="redis适用规范">
            
	            redis适用规范
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
                    <a href="/tags/数据库" title='数据库'>
                        数据库
                    </a>
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2022/04/06</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <ul>
<li>一、<a href="##键名设计">键名设计</a><ul>
<li>1、 <a href="###key名设计">key名设计</a></li>
<li>2、 <a href="###value设计">value设计</a></li>
</ul>
</li>
<li>二、<a href="##命令使用">命令使用</a></li>
<li>三、<a href="##缓存设计">缓存设计</a></li>
<li>四、<a href="##场景实战问题">场景实战问题</a><ul>
<li>1、<a href="###项目redis使用问题">项目redis使用问题</a></li>
<li>2、<a href="###慎用laravel自带的cache功能">慎用laravel自带的cache功能</a></li>
<li>3、<a href="###注意key的过期时间设置">注意key的过期时间设置</a></li>
<li>4、<a href="###小心缓存穿透">小心缓存穿透</a></li>
<li>5、<a href="###慎用缓存层层包裹">慎用缓存层层包裹</a></li>
<li>6、<a href="###慎用将redis做为消息队列">慎用将redis做为消息队列</a></li>
</ul>
</li>
<li>五、<a href="##查询使用问题">查询使用问题</a><ul>
<li>1、<a href="###线上Redis禁止使用Keys正则匹配操作">线上Redis禁止使用Keys正则匹配操作</a></li>
</ul>
</li>
<li>六、<a href="##其他">其他</a><ul>
<li>1、<a href="###目标内容">redis同步工具</a></li>
<li>2、<a href="###大key查询">大key查询</a></li>
</ul>
</li>
</ul>
<h2 id="键名设计"><a href="#键名设计" class="headerlink" title="键名设计"></a>键名设计</h2><h3 id="key名设计"><a href="#key名设计" class="headerlink" title="key名设计"></a>key名设计</h3><ol>
<li>禁止包含特殊（空格、换行、单双引号以及其他转义字符）</li>
<li>建议已业务名为前缀，以冒号分割来构造一定规则的key名(比如业务名:表名:id)  比如:<code>teach:leeson_id:21</code></li>
<li>key长度，key太长量一大起来就会非常占用内存</li>
</ol>
<h3 id="value设计"><a href="#value设计" class="headerlink" title="value设计"></a>value设计</h3><ol>
<li>拒绝大key操作</li>
</ol>
<p>禁用超过10K的string大key(虽然redis支持512MB大小的string)，如果1mb的key每秒重复写入10次，就会导致写入网络IO达10MB。</p>
<p>错误示范：直接将laravel的整个模型或者对象当成value存储</p>
<ol start="2">
<li>设计key时使用合适的数据类型(在资源利用和性能之间作平衡)</li>
</ol>
<p>错误示范：一个普通字符串弄成hash类型进行存储</p>
<ol start="3">
<li>一定要控制key的生命周期</li>
</ol>
<p>错误示范：key设置为永不过期</p>
<ol start="4">
<li>控制value长度</li>
</ol>
<p>比如string类型，如果value为’8个字节的长整型’则内部使用int类型，如果value为’小于等于39个字节的字符串’则内部使用embstr类型，如果value为’大于39个字节的字符串’则内部使用raw类型。这样能很好的利用redis的性能。</p>
<ol start="5">
<li>数据按需存储</li>
</ol>
<p>不需要的数据千万不要存储在redis，只会浪费内存空间</p>
<p>  基于 Spring Boot + MyBatis Plus + Vue &amp; Element 实现的后台管理系统 + 用户小程序，支持 RBAC 动态权限、多租户、数据权限、工作流、三方登录、支付、短信、商城等功能。</p>
<p>  项目地址：<a href="http://github.com/YunaiV/ruoyi-vue-pro" target="_blank" rel="noopener">http://github.com/YunaiV/ruoyi-vue-pro</a></p>
<h2 id="命令使用"><a href="#命令使用" class="headerlink" title="命令使用"></a>命令使用</h2><p>1.禁止使用keys、flushall、hmgetall等命令</p>
<p>为防止业务研发的误操作，通常可以在交付redis实例之前将默认命令rename掉；而真正需要删除或者遍历key时可以使用scan家族命令</p>
<p>2.慎用hgetall、lrange、smembers、zrange等命令</p>
<p>除非业务场景需要，尽量不要使用这些命令。如果没有控制好会导致操作量过大，形成阻塞。</p>
<pre><code>基于微服务的思想，构建在 B2C 电商场景下的项目实战。核心技术栈，是 Spring Boot + Dubbo 。未来，会重构成 Spring Cloud Alibaba 。

项目地址：http://github.com/YunaiV/onemall
</code></pre><h2 id="缓存设计"><a href="#缓存设计" class="headerlink" title="缓存设计"></a>缓存设计</h2><ol>
<li>多个库的使用</li>
</ol>
<p>如果应用中会涉及到各种不同的redis数据存储，应该分库存储，最好是一种业务使用一个库</p>
<p>比如：课程缓存:库1；订单队列:库2；日志处理:库3</p>
<ol start="2">
<li>避免多个应用公用一个redis实例</li>
</ol>
<p>避免一个应用出现问题或者错误使用拖累其他应用</p>
<ol start="3">
<li>合理评估业务场景，并设置最大内存以及内存淘汰策略(maxmemory和maxmemory-policy)</li>
</ol>
<ol start="4">
<li><p>使用带有连接池的数据库，可以有效控制连接，同时提高效率</p>
</li>
<li><p>给redis设置一个密码</p>
</li>
<li><p>冷热数据区分</p>
</li>
</ol>
<p>虽然 Redis支持持久化，但将所有数据存储在redis中，成本非常昂贵。建议将热数据 (如 QPS超过 5k) 的数据加载到redis中。低频数据可存储在Mysql、ElasticSearch中。</p>
<ol start="7">
<li>缓存非特殊情况不做中间态 redis大多数时候都是做缓存用，去掉后业务逻辑不应发生改变，万不可切入到业务里。</li>
</ol>
<p>缓存的高可用会影响业务；产生深耦合会发生无法预料的效果；会对维护产生负效果。</p>
<h2 id="场景实战问题"><a href="#场景实战问题" class="headerlink" title="场景实战问题"></a>场景实战问题</h2><h3 id="项目redis使用问题"><a href="#项目redis使用问题" class="headerlink" title="项目redis使用问题"></a>项目redis使用问题</h3><p>当前的使用方式是，每个接入的应用要配置核心项目的redis配置。这样是不合理的，核心项目的redis应该只能在核心项目中使用，对外应该是提供api接口或者rpc进行访问。</p>
<h3 id="慎用laravel自带的cache功能"><a href="#慎用laravel自带的cache功能" class="headerlink" title="慎用laravel自带的cache功能"></a>慎用laravel自带的cache功能</h3><p>laravel自带的cache功能最容易导致大key，经常由于简单使用至今将整个对象模型存储到redis，造成大key。</p>
<h3 id="注意key的过期时间设置"><a href="#注意key的过期时间设置" class="headerlink" title="注意key的过期时间设置"></a>注意key的过期时间设置</h3><p>在报名等高峰期的时候，key值设置过短容易造成缓存穿透，导致大量请求直接打到mysql数据库。</p>
<h3 id="小心缓存穿透"><a href="#小心缓存穿透" class="headerlink" title="小心缓存穿透"></a>小心缓存穿透</h3><p>经常使用会只给有数据的结果进行缓存，结果导致空数据无法缓存，相同查询直接每次都到达数据库，所以空值也应该被缓存。</p>
<h3 id="慎用缓存层层包裹"><a href="#慎用缓存层层包裹" class="headerlink" title="慎用缓存层层包裹"></a>慎用缓存层层包裹</h3><p>缓存里面的数据还有一层缓存数据，会导致问题排查麻烦，出问题也不容易处理。</p>
<h3 id="慎用将redis做为消息队列"><a href="#慎用将redis做为消息队列" class="headerlink" title="慎用将redis做为消息队列"></a>慎用将redis做为消息队列</h3><p>如没有非常特殊的需求，严禁将 Redis 当作消息队列使用。redis 当作消息队列使用，会有容量、网络、效率、功能方面的多种问题。</p>
<p>如需要消息队列，可使用高吞吐的 Kafka 或者高可靠的 RocketMQ，nsq,(花园同步有时间前后要求，且量不大才使用的)。</p>
<h2 id="查询使用问题"><a href="#查询使用问题" class="headerlink" title="查询使用问题"></a>查询使用问题</h2><h3 id="线上Redis禁止使用Keys正则匹配操作"><a href="#线上Redis禁止使用Keys正则匹配操作" class="headerlink" title="线上Redis禁止使用Keys正则匹配操作"></a>线上Redis禁止使用Keys正则匹配操作</h3><p>redis是单线程处理，在线上Key数量较多时，操作效率极低【时间复杂度为O(N)】，该命令一旦执行会严重阻塞线上其它命令的正常请求，而且在高QPS情况下会直接造成redis服务崩溃！</p>
<p>如果有类似需求，请使用scan命令代替。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="redis同步工具"><a href="#redis同步工具" class="headerlink" title="redis同步工具"></a>redis同步工具</h3><h3 id="大key查询"><a href="#大key查询" class="headerlink" title="大key查询"></a>大key查询</h3>
    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 ,图片资源转自pexels © <a href="" target="_blank">Ocean</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2022/04/01/主要工业软件盘点/" class="next-post btn btn-default" title='主要工业软件盘点'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">主要工业软件盘点</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	<link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css">
<script src="https://jjeejj.github.io/js/gitment.js"></script>

<script>
    var gitment = new Gitment({
        id: 'Wed Apr 06 2022 15:03:54 GMT+0800',
        owner:"LiuHaiYang",
        repo:"liuhaiyang.github.io",
        oauth: {
          client_id:"aacf4f5555aee5bf0770",
          client_secret:"07f91d5b66c30419c14d14349ccadaa91300bc9c"
        },
        perPage:"10",
    });
    gitment.render('comments');
</script>

    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#键名设计"><span class="toc-text">键名设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#key名设计"><span class="toc-text">key名设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#value设计"><span class="toc-text">value设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令使用"><span class="toc-text">命令使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存设计"><span class="toc-text">缓存设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#场景实战问题"><span class="toc-text">场景实战问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目redis使用问题"><span class="toc-text">项目redis使用问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#慎用laravel自带的cache功能"><span class="toc-text">慎用laravel自带的cache功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意key的过期时间设置"><span class="toc-text">注意key的过期时间设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小心缓存穿透"><span class="toc-text">小心缓存穿透</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#慎用缓存层层包裹"><span class="toc-text">慎用缓存层层包裹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#慎用将redis做为消息队列"><span class="toc-text">慎用将redis做为消息队列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询使用问题"><span class="toc-text">查询使用问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线上Redis禁止使用Keys正则匹配操作"><span class="toc-text">线上Redis禁止使用Keys正则匹配操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis同步工具"><span class="toc-text">redis同步工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大key查询"><span class="toc-text">大key查询</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2019
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Ocean</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>