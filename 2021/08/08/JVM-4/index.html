<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="meet you">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->





<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>JVM-4 | meet you</title>


    <link rel="alternate" href="/atom.xml" title="meet you" type="application/atom+xml">


    <link rel="icon" href="/img/favicon.ico">

    


    <link rel="stylesheet" href="//imsun.github.io/gitment/style/default.css">


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    


    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://snippet.shenliyang.com/img/banner.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Ocean'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> Always believe youself. </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">meet you</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/python/"><i class="fa "></i>python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/java/"><i class="fa "></i>JAVA</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/生活/"><i class="fa "></i>生活</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="JVM-4">
            
	            JVM-4
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
                    <a href="/tags/jvm" title='jvm'>
                        jvm
                    </a>
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2021/08/08</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="类加载与字节码技术"><a href="#类加载与字节码技术" class="headerlink" title="类加载与字节码技术"></a>类加载与字节码技术</h2><ul>
<li>类文件结构</li>
<li>字节码指令：每一个指令字节码都会对应一个操作</li>
<li>编译期处理</li>
<li>类加载阶段</li>
<li>类加载器</li>
<li>运行期优化</li>
</ul>
<p><img src="https://ae01.alicdn.com/kf/H3ede409c1d31420f8c8b279599d62b0cx.png" alt="image.png"></p>
<h3 id="整个流程："><a href="#整个流程：" class="headerlink" title="整个流程："></a>整个流程：</h3><p>java source code -&gt; 编译器（编译成）-&gt; 字节码 -&gt; 经过类加载器 -&gt; 加载到虚拟机中 -&gt; 通过执行引擎 -&gt; 解释器 运行（用到JVM的各种内存结构）</p>
<h3 id="字节码"><a href="#字节码" class="headerlink" title="字节码"></a>字节码</h3><p>字节码 （有JVM规范）有 头 + 16 进制码。 可以用 16 进制转10进制，然后去常量池中进行找。</p>
<p>javap 可以对class 文件进行反编译。 <code>javap -v HelloWorld.class</code></p>
<p>反编译后的结果会比 二进制字节码更容易理解。</p>
<p><img src="https://ae01.alicdn.com/kf/He9f1048bec824835ba6dac4b77ee87adC.png" alt="image.png"></p>
<h3 id="图解字节码"><a href="#图解字节码" class="headerlink" title="图解字节码"></a>图解字节码</h3><p><img src="https://ae04.alicdn.com/kf/H83d7ac1723ac4e7ea5bbbcfc5a25c2afn.png" alt="image.png"></p>
<p>练习：</p>
<p><img src="https://ae05.alicdn.com/kf/H235cb19d00c94be1be45b3b1ae5754240.png" alt="image.png"> </p>
<pre><code>a = 11  b = 34
</code></pre><p><img src="https://ae04.alicdn.com/kf/Hfd0d49f48f974b168277a78101f40489x.png" alt="image.png"></p>
<pre><code>a++ 先load,在自增 （先iload再iinc）
++a 先自增,再load （先iinc再iload）
</code></pre><p>指令顺序：</p>
<ol>
<li>bipush: 先把 10 放入 操作数 栈中</li>
<li>istore_1 : 把10 弹出来放入 1 号槽位，给 a 赋值 -&gt; a = 10 </li>
<li>a++  先 load 再自增，有两条指令 <ul>
<li>iload_1 把 a 这个值 先 load 进来 </li>
<li>iinc 两个 参数  1： 哪个槽位。2： 自增几  a= 11</li>
</ul>
</li>
<li>++a 先自增，在load<ul>
<li>iinc : a = 12</li>
<li>iload: 把 12 加入到操作数 栈</li>
</ul>
</li>
<li>做 + ，把 那两个 （10 和 12） 都弹出了，把结果 22 加到了操作数栈<ul>
<li>iadd ： 10 + 12 </li>
</ul>
</li>
<li>a–。先 load 再 自增<ul>
<li>把 a ：12  放入操作数栈</li>
<li>再 自减。a =11</li>
</ul>
</li>
<li>加 a++ 这时候，放入 操作栈的 a 是 12 。所以 是 22 + 12 </li>
</ol>
<p>条件判断指令：</p>
<p><img src="https://ae01.alicdn.com/kf/Hdd328b0a3c6d435db25c51fe2cc3a791y.png" alt="image.png"></p>
<p><img src="https://ae03.alicdn.com/kf/H66c4afe91d104687a3123afd6938163bs.png" alt="image.png"> </p>
<p>练习：</p>
<p><img src="https://ae05.alicdn.com/kf/Hff4ff59d11f645b7b81ba17bbb8caefaY.png" alt="image.png"></p>
<p>流程解析：</p>
<ol>
<li>x = 0 x: 局部变量中的一个槽位，值 为 0</li>
<li><p>第一次循环： </p>
<ul>
<li><p>x++</p>
<p>  iload_x: 先把 x 即 0 读入到操作数栈 x 还是 0<br>  iinc : x++ : x = 1 这是 x 在槽位中，值（局部变量） 为 1</p>
</li>
<li><p>x = x++ : 把操作数栈中 的 0 拿出来 覆盖了 本地变量中的 x 。所以 x 还是 0 </p>
</li>
</ul>
</li>
<li><p>循环 n 次 x 还是 0 </p>
</li>
</ol>
<h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><ul>
<li><p><code>&lt;cinit()V&gt;</code><br><img src="https://ae01.alicdn.com/kf/Hab167ce707ac498b9ab807cad395519dD.png" alt="image.png"></p>
<p>  编译器会按从上至下的顺序，收集所有 static 静态代码块，和静态成员赋值的代码，合并为一个特殊的方法<code>&lt;cinit&gt;()V</code><br>  i 被 复制了 3 次， i 最终 为 30 </p>
</li>
<li><p><code>&lt;init()V&gt;</code></p>
<p>  编译器会按从上至下的顺序，收集所有代码块 和成员变量赋值的代码块，会形成新的构成方法，但原始构造方法内的代码块总是在最后。</p>
</li>
</ul>
<h3 id="多态的原理"><a href="#多态的原理" class="headerlink" title="多态的原理"></a>多态的原理</h3><ul>
<li>vtable </li>
</ul>
<p><img src="https://ae01.alicdn.com/kf/H02d50ff4d591457f92398ea8e1f1d6451.png" alt="image.png"></p>
<h3 id="异常的处理"><a href="#异常的处理" class="headerlink" title="异常的处理"></a>异常的处理</h3><p>单个 catch： </p>
<p>字节码中有 Exception table， 即 出现异常时操作，有 from to （监测的范围） target type 这些参数。这个这些行内 出现异常，先进行类型匹配，如果发生的异常和 声明的异常（包含子类） 是否一直，一直进入 target 行。</p>
<p><img src="https://ae01.alicdn.com/kf/H97c90232c41b4459a243529b64ba65fcY.png" alt="image.png"></p>
<p>多个 catch：</p>
<p>会有多个 goto。有异常出现时，之后进入到一个。会有槽位的复用，用一个槽位进行存储。</p>
<p><img src="https://ae04.alicdn.com/kf/Ha5027fc0f0b34a0ebccdafb714d79ed1W.png" alt="image.png"></p>
<p>finally:</p>
<ul>
<li>每个 代码块后都会加上 finally 的代码。finally 的代码 被复制了三次放入到 try ，catch， 捕获不到的异常代码的后面。</li>
<li>如果捕获不到声明的异常时，也会运行 finally 然后在 throw 抛出异常。</li>
</ul>
<p>finally 练习题：</p>
<p><img src="https://ae01.alicdn.com/kf/H974f79a4319c475caff1d0eb0a0f5065h.png" alt="image.png"></p>
<p><img src="https://ae04.alicdn.com/kf/H871c1fdbf66f4c028f4818718e0aced4E.png" alt="image.png"></p>
<ul>
<li>先把返回的结果暂存，等finally 内容执行完在把暂存结果返回的。</li>
<li>如果finally 有修改 return 的变量， 其实返回的还是未修改前的值（暂存的值）。</li>
</ul>
<h3 id="synchronized-底层原理"><a href="#synchronized-底层原理" class="headerlink" title="synchronized 底层原理"></a>synchronized 底层原理</h3><p>加锁操作，解锁 成对出现。</p>
<p><img src="https://ae04.alicdn.com/kf/H0d7168b6512a4c1693ef9615409d3b51D.png" alt="image.png"></p>
<pre><code>new 对象  会把对象的地址放入到操作数栈
dup 把对象的引用 复制了一份， 为了用两次 1) 调用构造方法 2）第二个引用复制到第一个槽位 lock，lock 局部变量引用。


monitorenter ： 加锁
monitorexit ： 解锁
</code></pre>
    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 ,图片资源转自pexels © <a href="" target="_blank">Ocean</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2021/08/07/JVM-3/" class="next-post btn btn-default" title='JVM-3'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">JVM-3</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	<link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css">
<script src="https://jjeejj.github.io/js/gitment.js"></script>

<script>
    var gitment = new Gitment({
        id: 'Sun Aug 08 2021 23:11:46 GMT+0800',
        owner:"LiuHaiYang",
        repo:"liuhaiyang.github.io",
        oauth: {
          client_id:"aacf4f5555aee5bf0770",
          client_secret:"07f91d5b66c30419c14d14349ccadaa91300bc9c"
        },
        perPage:"10",
    });
    gitment.render('comments');
</script>

    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#类加载与字节码技术"><span class="toc-text">类加载与字节码技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#整个流程："><span class="toc-text">整个流程：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字节码"><span class="toc-text">字节码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图解字节码"><span class="toc-text">图解字节码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造方法"><span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多态的原理"><span class="toc-text">多态的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异常的处理"><span class="toc-text">异常的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronized-底层原理"><span class="toc-text">synchronized 底层原理</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2019
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Ocean</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>